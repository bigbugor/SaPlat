#include("/template/common/layout/_page_layout.html")
#@layout()

#define css()
<link rel="stylesheet" href="#(RESOURCE_HOST)/static/css/zTreeStyle/zTreeStyle.css" type="text/css">
<style>

</style>
#end

#define js()
<script type="text/javascript">
    var element = '#(fileProject.toJson())';
    var fileProject = JSON.parse(element);
    layui.use(['table', 'layer', 'upload'], function () {
        var table = layui.table
            , layer = layui.layer
            , $ = layui.jquery
            , upload = layui.upload;

        var percent = '#(percent)';
        if (percent < 100) {
            layer.msg("不可上传状态。请确保您已填写了所有资料以及上传了所有资料！");
            $('#add').remove();
        } else {
            $('#add').removeClass("layui-hide");
        }
        upload.render({
            elem: '#add'
            , url: '#(ctxPath)/util/uploadFile'
            , accept: 'file'
            //,multiple: true
            , exts: 'doc|docx|pdf'
            , data: {
                description: "文档文件"
            }
            , done: function (res) {
                console.log(res);
                if (res.code == 0) {
                    postFileID(fileProject.fileTypeID, res.data.fileId, fileProject.projectID);
                    return true;
                } else if (res.code == 1) {
                    layer.msg("文件上传失败，请重新选择上传！");
                    return false;
                }
            }
            , error: function (index, upload) {
                layer.msg("文件上传错误！请重新尝试！");
            }
        });

    });

    function postFileID(_fileTypeID, _fileID, _projectID) {
        util.sendAjax({
            type: 'POST',
            url: '#(ctxPath)/app/fileupload/documentSave',
            data: {
                'fileProject.fileID': _fileID,
                'fileProject.projectID': _projectID,
                'fileProject.fileTypeID': _fileTypeID
            },
            loadFlag: true,
            success: function (data) {
                window.location.reload();
            },
            unSuccess: function (data) {
            }
        })
    }

    $("#sub").click(function () {
        util.sendAjax({
            type: 'POST',
            url: '#(ctxPath)/app/fileupload/documentSub',
            data: {
                fileProjectID: fileProject.id
            },
            loadFlag: true,
            success: function (data) {
                window.location.reload();
            },
            unSuccess: function (data) {
            }
        });
    });
    $("#view").click(function () {
        pop_show('查看文件', '#(ctxPath)/util/pdfView?fileID=' + fileProject.fileID, '', '', function () {
        });
    });

</script>
#end

#define content()
<div class="layui-fluid">
    <fieldset class="layui-elem-field site-demo-button" style="margin-top: 30px;">
        <legend class="x-center">预审报告</legend>
        #if(!fileProject.isEnable)
        <div class="x-center">
            <h3>上传预审报告文件</h3>
            <button id="add" class="layui-btn layui-btn-small layui-hide">上传</button>
        </div>
        #if(fileProject.fileID!=null)
        <div class="x-center">
            <h3>预览预审报告文件</h3>
            <button id="view" class="layui-btn layui-btn-small">预览</button>
        </div>

        <div class="x-center">
            <h3>提交预审报告文件</h3>
            <button id="sub" class="layui-btn layui-btn-small">提交</button>
        </div>
        #end
        #else
        <div class="x-center">
            <h1>你已提交文件</h1>
        </div>
        #end
    </fieldset>
</div>
#end