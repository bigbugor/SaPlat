#include("/template/common/layout/_page_layout.html")
#@layout()

#define css()
<style>
    button {
        background: #758ef0;
        color: #FFF;
        border: none;
        border-radius: 15px;
    }
</style>
#end


#define content()
<div class="layui-fluid">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px; color: #009688">
        <legend style="font-size: 20px;font-weight: 500;">服务机构认证</legend>
    </fieldset>

    <form id="person" class="layui-form " action="">
        <div class="layui-form-pane">

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.name" style="width: 180px">服务机构名称</label>
                <div class="layui-input-inline" style="margin: 0 180px">
                    <input type="text" id="facAgency.name" name="facAgency.name" value="#(organization.name)"
                           class="layui-input layui-disabled layui-hide" style="width: 500px" required/>
                    <p>#(organization.name)</p>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.orgID"style="width: 180px">组织机构编号</label>
                <div class="layui-input-inline" style="margin: 0 180px">
                    <input type="number" id="facAgency.orgID" name="facAgency.orgID" value="#(organization.id)"
                           class="layui-input layui-disabled layui-hide" style="width: 500px" required/>
                    <p>#(organization.id)</p>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label"style="width: 180px"><em class="require-mark">*</em>维稳办备案文件照片</label>
                <div class="layui-input-block layui-upload" style="margin: 0 180px">
                    <button type="button" class="layui-btn" id="upload" style="margin: 0 200px"><i class="layui-icon" ></i>上传文件</button>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.address"style="width: 180px">公司地址</label>
                <div class="layui-input-block" style="margin: 0 180px">
                    <input type="text" id="facAgency.address" name="facAgency.address"
                           value="#(facAgency.address)" class="layui-input" style="width: 500px" required/>
                </div>
            </div>

            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label" for="facAgency.resume" style="width: 680px;">
                    <h style="margin: 0 50px">公司简介</h>
                </label>
                <div class="layui-input-block">
					<textarea id="facAgency.resume" name="facAgency.resume" lay-verify="required" placeholder=""
                              class="layui-textarea"
                              cols="100" rows="2" wrap="hard" autocomplete="off" style="width: 680px">#(facAgency.resume)</textarea>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.principal"style="width: 180px">公司负责人</label>
                <div class="layui-input-block" style="margin: 0 180px">
                    <input type="text" id="facAgency.principal" name="facAgency.principal"
                           value="#(facAgency.principal)" class="layui-input"style="width: 500px"  required/>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.phone"style="width: 180px">公司负责人联系方式</label>
                <div class="layui-input-block" style="margin: 0 180px">
                    <input type="tel" id="facAgency.phone" name="facAgency.phone"
                           value="#(facAgency.phone)" class="layui-input"style="width: 500px"  required/>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.type"style="width: 180px">主体类型</label>
                <div class="layui-input-block" style="margin: 0 180px">
                    <input type="text" id="facAgency.type" name="facAgency.type"
                           value="#(facAgency.type)" class="layui-input"style="width: 500px"  required/>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.credit"style="width: 180px">统一社会信用代码</label>
                <div class="layui-input-block" style="margin: 0 180px">
                    <input type="text" id="facAgency.credit" name="facAgency.credit"
                           value="#(facAgency.credit)" class="layui-input"style="width: 500px"  required/>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.scope"style="width: 180px">业务范围</label>
                <div class="layui-input-block" style="margin: 0 180px">
                    <input type="text" id="facAgency.scope" name="facAgency.scope"
                           value="#(facAgency.scope)" class="layui-input"style="width: 500px"  required/>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.start"style="width: 180px">创办日期</label>
                <div class="layui-input-block" style="margin: 0 180px">
                    <input type="date" id="facAgency.start" name="facAgency.start"
                           value="#(facAgency.start)" class="layui-input"style="width: 500px"  required/>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.person"style="width: 180px">企业法人</label>
                <div class="layui-input-block" style="margin: 0 180px">
                    <input type="text" id="facAgency.person" name="facAgency.person"
                           value="#(facAgency.person)" class="layui-input"style="width: 500px"  required/>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label "style="width: 180px"><em class="require-mark">*</em>法人身份证照片</label>
                <div class="layui-input-block layui-upload" style="margin: 0 180px">
                    <button type="button" class="layui-btn" id="upload1" style="margin: 0 200px"><i class="layui-icon" ></i>上传文件</button>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.capital"style="width: 180px">注册资本</label>
                <div class="layui-input-block" style="margin: 0 180px">
                    <input type="number" id="facAgency.capital" name="facAgency.capital"
                           value="#(facAgency.capital)" class="layui-input"style="width: 500px"  required/>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.website"style="width: 180px">企业网站</label>
                <div class="layui-input-block" style="margin: 0 180px">
                    <input type="text" id="facAgency.website" name="facAgency.website"
                           value="#(facAgency.website)" class="layui-input"style="width: 500px"  required/>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.landline"style="width: 180px">座机电话</label>
                <div class="layui-input-block" style="margin: 0 180px">
                    <input type="text" id="facAgency.landline" name="facAgency.landline"
                           value="#(facAgency.landline)" class="layui-input" style="width: 500px" required/>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="facAgency.scale"style="width: 180px">企业人数</label>
                <div class="layui-input-block" style="margin: 0 180px">
                    <input type="number" id="facAgency.scale" name="facAgency.scale"
                           value="#(facAgency.scale)" class="layui-input" style="width: 500px" required/>
                </div>
            </div>

            <!--隐藏flag作为界面是否禁用的方法-->
            <input type="text" id="flag" name="flag"
                   class="layui-input layui-disabled layui-hide" value="#(flag)" required/>
            <br>
            <div class="layui-form-item">
                <div class="layui-input-block" style="margin: 0 180px">
                    <button type="button" class="layui-btn" lay-submit lay-filter="sub">保存</button>
                    <button type="button" class="layui-btn layui-btn-warm" id="reset">取消</button>
                    <button type="button" class="layui-btn layui-btn-warm layui-hide" id="back">返回</button>
                </div>
            </div>
        </div>
    </form>
</div>

#end


#define js()
<script type="text/javascript">
    layui.use(['form', 'layer', 'upload'], function () {
        var layer = layui.layer
            , $ = layui.jquery
            , form = layui.form
            , upload = layui.upload;

        var fileFromID, fileFromID1;

        upload.render({
            elem: '#upload'
            , url: '#(ctxPath)/util/uploadFile'
            , accept: 'file'
            , exts: 'doc|docx|pdf'
            , data: {
                description: "服务机构维稳备案文件照片"
            }, before: function (res) {
                var bg = $('<div class="loading-bg"><i class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop loading-ico"></i></div>');
                $('body').prepend(bg);
            }, done: function (res) {
                if (res.code == 0) {
                    $('.loading-bg').remove();
                    $.post('#(ctxPath)/app/organization/upload?fileId=' + res.data.fileId + '&tableName=facAgency&fieldName=维稳备案文件照片', function (data) {
                        fileFromID = data.fileFromID;
                        layer.msg("上传成功");
                    });
                } else if (res.code == 1) {
                    layer.msg("文件上传失败，请重新选择上传！");
                    setTimeout(function () {
                    }, 1000);
                }
            }
            , error: function (index, upload) {
                alert("文件上传错误！请重新尝试！");
            }
        });

        upload.render({
            elem: '#upload1'
            , url: '#(ctxPath)/util/uploadFile'
            , accept: 'file'
            , exts: 'doc|docx|pdf'
            , data: {
                description: "服务机构法人身份证照片"
            }, before: function (res) {
                var bg = $('<div class="loading-bg"><i class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop loading-ico"></i></div>');
                $('body').prepend(bg);
            }, done: function (res) {
                if (res.code == 0) {
                    $('.loading-bg').remove();
                    $.post('#(ctxPath)/app/organization/upload?fileId=' + res.data.fileId + '&tableName=facAgency&fieldName=法人身份证照片', function (data) {
                        fileFromID1 = data.fileFromID;
                        layer.msg("上传成功");
                    });
                } else if (res.code == 1) {
                    layer.msg("文件上传失败，请重新选择上传！");
                    setTimeout(function () {
                    }, 1000);
                }
            }
            , error: function (index, upload) {
                alert("文件上传错误！请重新尝试！");
            }
        });


        form.on('submit(sub)', function (data) {
            if(isNaN(parseInt(fileFromID)) || isNaN(parseInt(fileFromID1))){
                layer.msg("您的文件还没有上传,请上传后再提交");
                return false;
            }
            util.sendAjax({
                type: 'POST',
                url: '#(ctxPath)/app/organization/facAgencyProve?fileFromID=' + fileFromID + '&fileFromID1=' + fileFromID1,
                data: $.param(data.field),
                loadFlag: true,
                success: function (data) {
                    window.location.href = '#(ctxPath)/app/organization/prove';
                    return true;
                },
                error: function (data) {
                    console.log(data);
                }
            });
            return false;
        });
    });

    if ($('#flag').val() == 1) {
        $(".layui-btn").addClass("layui-hide");
        $(":input").addClass("layui-disabled");
        $(":input").attr("disabled", "disabled");
        $('#back').removeClass('layui-hide').removeClass('layui-disabled').attr("disabled","");
    }
    $('#back').click(function () {
        history.back();
    });
    $('#reset').click(function () {
        history.back();
    });
</script>
#end